
@model IEnumerable<Student>
@{
    ViewData["Title"] = "All Student Information";
}

<h3>@ViewData["Title"]</h3>

<div class="d-flex align-items-center mb-3">
    <a asp-action="Create" class="btn btn-outline-primary me-2">Create</a>
    <input type="text" id="searchBox" class="form-control me-2" placeholder="Search..." />
</div>

<div id="studentTableContainer">
    <table class="table table-bordered table-hover">
        <thead>
            <tr class="text-center">
                <th>Student Name</th>
                <th>Mobile</th>
                <th>Email</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="studentTableBody">
            @foreach (var item in Model)
            {
                <tr class="text-center">
                    <td>@item.Name</td>
                    <td>@item.Mobile</td>
                    <td>@item.Email</td>
                    <td>@item.Age</td>
                    <td>@item.Gender</td>
                    <td>
                        <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-info btn-sm">Details</a>
                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary btn-sm">Edit</a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            let debounceTimer;

            $("#searchBox").on("keyup", function () {
                clearTimeout(debounceTimer);
                var searchString = $(this).val();

                debounceTimer = setTimeout(function () {
                    $.ajax({
                        url: '@Url.Action("Search", "Student")',
                        type: 'GET',
                        data: { searchString: searchString },
                        success: function (students) {
                            let rows = '';
                            if (students.length === 0) {
                                rows = '<tr><td colspan="6" class="text-center text-muted">No matching students found</td></tr>';
                            } else {
                                $.each(students, function (i, s) {
                                    rows += `
                                        <tr class="text-center">
                                            <td>${s.name}</td>
                                            <td>${s.mobile}</td>
                                            <td>${s.email}</td>
                                            <td>${s.age}</td>
                                            <td>${s.gender}</td>
                                            <td>
                                                <a href="/Student/Details/${s.id}" class="btn btn-info btn-sm">Details</a>
                                                <a href="/Student/Edit/${s.id}" class="btn btn-primary btn-sm">Edit</a>
                                                <a href="/Student/Delete/${s.id}" class="btn btn-danger btn-sm">Delete</a>
                                            </td>
                                        </tr>`;
                                });
                            }
                            $("#studentTableBody").html(rows);
                        },
                        error: function (err) {
                            console.error("Error:", err);
                        }
                    });
                }, 300); 
            });
        });
    </script>
}
